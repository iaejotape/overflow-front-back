<ion-content [fullscreen]="true" [scrollY]="true">
  <div class="questoes-container">

    <!-- aqui √© o header -->
    <header class="page-header">
      <img src="assets/img/overflow-logo.svg" alt="Overflow" class="header-logo">
    </header>

    <!-- aqui √© o conteudo principal -->
    <main class="page-content">

      <!-- aqui √© o titulo da pagina -->
      <div class="page-title">
        <h1>Quest√µes</h1>
        <p class="subtitle">Desafios para voc√™ praticar</p>
      </div>

      <!-- aqui √© o filtro de categorias -->
      <div class="categories-filter">
        <button
          class="category-chip"
          *ngFor="let cat of categoriasFiltro"
          [class.active]="categoriaFiltroAtiva === cat.value"
          (click)="selecionarFiltroCategoria(cat.value)"
        >
          {{ cat.label }}
        </button>
      </div>


      <!-- aqui sao os cards de estatisticas -->
      <div class="stats-row">
        <!-- aqui √© o progresso -->
        <div class="stat-card progress-stat">
          <div class="progress-ring">
            <svg viewBox="0 0 100 100">
              <circle class="bg" cx="50" cy="50" r="40"/>
              <circle class="progress" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="150"/>
            </svg>
            <div class="progress-text">
              <span class="percent">40%</span>
              <span class="label">Finalizado</span>
            </div>
          </div>
        </div>

        <!-- aqui √© o top 3 rank -->
        <div class="stat-card rank-stat">
          <h3>Top 3 - Rank</h3>
          <div class="rank-list">
            <div class="rank-item">
              <span class="medal gold">ü•á</span>
              <span class="name">OverFlows</span>
              <span class="pts">100Pts</span>
            </div>
            <div class="rank-item">
              <span class="medal silver">ü•à</span>
              <span class="name">Fulanos</span>
              <span class="pts">90Pts</span>
            </div>
            <div class="rank-item">
              <span class="medal bronze">ü•â</span>
              <span class="name">Sicranos</span>
              <span class="pts">70Pts</span>
            </div>
          </div>
        </div>
      </div>

      <!-- aqui √© o card de envios corretos -->
      <div class="envios-card">
        <div class="envios-ring">
          <svg viewBox="0 0 100 100">
            <circle class="bg" cx="50" cy="50" r="40"/>
            <circle class="progress" cx="50" cy="50" r="40" stroke-dasharray="251.2" stroke-dashoffset="70"/>
          </svg>
          <div class="check-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          </div>
        </div>
        <div class="envios-info">
          <span class="envios-label">Envios Corretos</span>
          <span class="envios-value">26/36</span>
        </div>
      </div>

      <!-- aqui √© a lista de questoes -->
      <div class="questoes-list">
        <h2 class="section-title">Quest√µes Dispon√≠veis</h2>

        <ng-container *ngIf="!carregando; else loadingTemplate">

          <ng-container *ngIf="questoesFiltradas.length > 0; else semQuestoes">
            <div class="questao-card" *ngFor="let q of questoesFiltradas">
              <div class="questao-header">
                <h3 class="questao-titulo">{{ q.titulo }}</h3>
                <div class="questao-actions">
                  <button class="action-btn edit" (click)="editarQuestao(q.id)">
                    <!-- √≠cone edit -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                  </button>
                  <button class="action-btn delete" (click)="confirmarExclusao(q)">
                    <!-- √≠cone delete -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h18"/>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      <line x1="10" y1="11" x2="10" y2="17"/>
                      <line x1="14" y1="11" x2="14" y2="17"/>
                    </svg>
                  </button>
                </div>
              </div>

              <p class="questao-descricao">{{ q.enunciado }}</p>

              <div class="questao-footer">
                <div class="questao-meta">
                  <span class="autor">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Por {{ q.autor }}
                  </span>
                  <span class="envios">
                    <!-- placeholder por enquanto -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 2L11 13"/>
                      <path d="M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                    Envios corretos: ‚Äî
                  </span>
                </div>
                <div class="questao-tags">
                  <span class="tag categoria">{{ mapCategoria(q.categoria) }}</span>
                  <span class="tag dificuldade" [ngClass]="mapClasseDificuldade(q.nivel)">
                    {{ mapNivel(q.nivel) }}
                  </span>
                  <span class="tag xp">+{{ q.pontuacao }} Pts</span>
                </div>
              </div>
            </div>
          </ng-container>

          <ng-template #semQuestoes>
            <p>Nenhuma quest√£o cadastrada ainda.</p>
          </ng-template>

        </ng-container>

        <ng-template #loadingTemplate>
          <p>Carregando quest√µes...</p>
        </ng-template>
      </div>


    </main>

    <!-- aqui √© o botao de nova questao -->
    <button class="fab-button" (click)="novaQuestao()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      <span>Nova Quest√£o</span>
    </button>

    <!-- aqui √© o menu de navegacao -->
    <nav class="bottom-nav">
      <button class="nav-item" [class.active]="menuAtivo === 'home'" (click)="navegarPara('home')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        </svg>
      </button>
      <button class="nav-item" [class.active]="menuAtivo === 'questoes'" (click)="navegarPara('questoes')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C8.5 2 5 5.5 5 10c0 4.5 3 7 5 9.5.5.6 1.2 1 2 1s1.5-.4 2-1c2-2.5 5-5 5-9.5 0-4.5-3.5-8-7-8z"/>
          <path d="M12 21v2" stroke="currentColor" stroke-width="2" fill="none"/>
          <path d="M10 23h4" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </button>
      <button class="nav-item" [class.active]="menuAtivo === 'conquistas'" (click)="navegarPara('conquistas')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
          <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
          <path d="M4 22h16"/>
          <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
        </svg>
      </button>
      <button class="nav-item" [class.active]="menuAtivo === 'stats'" (click)="navegarPara('stats')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M4 20h16"/>
          <rect x="4" y="12" width="3" height="8"/>
          <rect x="10" y="8" width="3" height="12"/>
          <rect x="16" y="4" width="3" height="16"/>
        </svg>
      </button>
      <button class="nav-item" [class.active]="menuAtivo === 'perfil'" (click)="navegarPara('perfil')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      </button>
    </nav>

    <!-- Modal de confirma√ß√£o de exclus√£o -->
    <div class="modal-overlay" *ngIf="mostrarModalExclusao" (click)="fecharModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
        </div>
        <h3 class="modal-title">Excluir Quest√£o</h3>
        <p class="modal-message">Tem certeza que deseja excluir a quest√£o "<strong>{{ questaoParaExcluir?.titulo }}</strong>"?</p>
        <p class="modal-warning">Esta a√ß√£o n√£o pode ser desfeita.</p>
        <div class="modal-actions">
          <button class="btn-cancelar" (click)="fecharModal()">Cancelar</button>
          <button class="btn-excluir" (click)="excluirQuestao()">Excluir</button>
        </div>
      </div>
    </div>

  </div>
</ion-content>
